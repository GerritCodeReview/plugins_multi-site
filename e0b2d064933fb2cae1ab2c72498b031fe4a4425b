{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5142787e_a1dd052c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2024-02-06T12:58:33Z",
      "side": 1,
      "message": "shouldn\u0027t we cancel that future before it\u0027s removed, just in case it just got started between the `get` and `remove`?\n\nif yes, we could then just reuse `cancelPreviousTask()` here",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "33402d79_21d18a3a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-07T14:17:57Z",
      "side": 1,
      "message": "We want to make sure that we will not kill another task when this one is stopping due to max tries. This task will not be rescheduled so there is no point to cancel it",
      "parentUuid": "5142787e_a1dd052c",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5552f5ee_b7b73ccb",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T11:46:19Z",
      "side": 1,
      "message": "I think this `return` statement is wrong.\nIf we successfully remove the `task` from the map, we are inherently causing the `rescheduleIndex` to return `true`, thus scheduling the task one more time, erroneously.",
      "range": {
        "startLine": 73,
        "startChar": 8,
        "endLine": 73,
        "endChar": 53
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b13076fc_4aa2faec",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 73,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "Good catch!",
      "parentUuid": "5552f5ee_b7b73ccb",
      "range": {
        "startLine": 73,
        "startChar": 8,
        "endLine": 73,
        "endChar": 53
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4a71c46a_fbe3311f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 86,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "How can the current thread be interrupted?\nthat would be the thread running the `ForwardedIndexingHandlerWithRetries`, not the thread running the `task` right?",
      "range": {
        "startLine": 85,
        "startChar": 0,
        "endLine": 86,
        "endChar": 49
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a8cb3b0b_ca99cb4e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 86,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "if you check how the task is scheduled in L100 you will notice that we are creating anonymous class which is calling methods from `ForwardedIndexingHandlerWithRetries`\nthis means that we are cancelling thread which is executing this anonymous class instance not the one which is running `ForwardedIndexingHandlerWithRetries`",
      "parentUuid": "4a71c46a_fbe3311f",
      "range": {
        "startLine": 85,
        "startChar": 0,
        "endLine": 86,
        "endChar": 49
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3bc6826f_28dd1fd1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "How do we infer that the task is `canceled` here?",
      "range": {
        "startLine": 87,
        "startChar": 6,
        "endLine": 87,
        "endChar": 65
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9e1e9dc_3882fe20",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "Setting `cancel(true)` does two things:\n\n* If the task has not started when cancel is called, this task will never start.\n\n* If the task has already started, then the `mayInterruptIfRunning` parameter determines is set to true.\n\nWe can check if `mayInterruptIfRunning` was set to true by calling:\n`Thread.currentThread().isInterrupted()`\n\nThis mean that we are checking if the task wasn\u0027t cancelled after it was started",
      "parentUuid": "3bc6826f_28dd1fd1",
      "range": {
        "startLine": 87,
        "startChar": 6,
        "endLine": 87,
        "endChar": 65
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6934b1b_c975d883",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2024-02-06T12:58:33Z",
      "side": 1,
      "message": "just a _sanity check_: we\u0027re here _killing_ the task, even if it\u0027s running and started processing the data. Are we sure that this is _safe_ and will not lead to index corruption?",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6dde3400_1c6a5457",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-07T14:17:57Z",
      "side": 1,
      "message": "The Future.cancel() method does not forcibly stop a task in the middle of execution. Instead, it attempts to cancel the execution of the task by setting its cancelled status to true.\n\nIf the task has already started, then the cancel() method\u0027s effect depends on the value of the mayInterruptIfRunning parameter:\n\n- If mayInterruptIfRunning is true, then the method will attempt to stop the task by interrupting the thread in which it\u0027s running. However, it\u0027s up to the implementation of the task to respond to the interruption appropriately. If the task doesn\u0027t handle interruptions (by checking the interrupted status and exiting if interrupted), then it won\u0027t be stopped.\n\n- If mayInterruptIfRunning is false, then the method won\u0027t interrupt the thread, and if the task has already started, it won\u0027t be stopped.\n\nIn summary, Future.cancel() can\u0027t forcibly stop a task in the middle of execution. It can only attempt to stop it, and whether the task actually stops depends on how the task is implemented.",
      "parentUuid": "a6934b1b_c975d883",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "30f52edb_d92e4b89",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2024-02-07T14:26:04Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "6dde3400_1c6a5457",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "135c45f8_6822086a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "Should we check the result of the `cancel()` here?\n`false` would mean that the task couldn\u0027t be cancelled, yet we are removing it from the map.\n\nI think it is still OK to schedule a new one and let the old one continue (even though it is destined to fail), however perhaps we could log this case to make it easier to debug reindexing failures?",
      "range": {
        "startLine": 117,
        "startChar": 0,
        "endLine": 117,
        "endChar": 24
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "27018104_adb13df1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 2
      },
      "lineNbr": 117,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "135c45f8_6822086a",
      "range": {
        "startLine": 117,
        "startChar": 0,
        "endLine": 117,
        "endChar": 24
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a2140de5_2be0f63b",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/CompletedScheduledFuture.java",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2024-02-06T12:58:33Z",
      "side": 1,
      "message": "nit: how about prefixing class name with `Test` to indicate that it\u0027s only for the testing purposes?",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "37680b9c_11055485",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/CompletedScheduledFuture.java",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-07T14:17:57Z",
      "side": 1,
      "message": "It\u0027s in the `src/test/java` so it cannot be reused outside of tests",
      "parentUuid": "a2140de5_2be0f63b",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "26de21d5_0238489f",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/CompletedScheduledFuture.java",
        "patchSetId": 2
      },
      "lineNbr": 26,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2024-02-07T14:25:45Z",
      "side": 1,
      "message": "sure, for bazel it may not have any difference, the thing is that it may pop in the code completions which maybe confusing.",
      "parentUuid": "37680b9c_11055485",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c70cb4ad_43531756",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexChangeHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 58,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "Have you considered adding a change to test the new functionality?",
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "46503e5c_96499a1d",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexChangeHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "nit: might be final",
      "range": {
        "startLine": 87,
        "startChar": 0,
        "endLine": 87,
        "endChar": 43
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fc8ee50a_197dd654",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexChangeHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "46503e5c_96499a1d",
      "range": {
        "startLine": 87,
        "startChar": 0,
        "endLine": 87,
        "endChar": 43
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1206ee25_452dedbd",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexChangeHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 103,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "This warns with:\n\n```\nUnchecked assignment: \u0027java.util.concurrent.ScheduledFuture\u0027 to \u0027java.util.concurrent.ScheduledFuture\u003c?\u003e\u0027 \n```",
      "range": {
        "startLine": 102,
        "startChar": 0,
        "endLine": 103,
        "endChar": 37
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a22b0338_b4d1d172",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexChangeHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 103,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1206ee25_452dedbd",
      "range": {
        "startLine": 102,
        "startChar": 0,
        "endLine": 103,
        "endChar": 37
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "baf4c90d_7fc2d518",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexGroupHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 60,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "nit: might be final",
      "range": {
        "startLine": 60,
        "startChar": 0,
        "endLine": 60,
        "endChar": 43
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bc3d9f13_3be25338",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexGroupHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 60,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "baf4c90d_7fc2d518",
      "range": {
        "startLine": 60,
        "startChar": 0,
        "endLine": 60,
        "endChar": 43
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "75f1e67d_a7c490d6",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexGroupHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2024-02-09T12:10:19Z",
      "side": 1,
      "message": "This is deprecated for removal:\n\n```\n    @Deprecated(since\u003d\"9\", forRemoval \u003d true)\n```\n\nConsider using `Long.valueOf()` instead",
      "range": {
        "startLine": 71,
        "startChar": 40,
        "endLine": 71,
        "endChar": 60
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f7bb6bae_fc74484d",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexGroupHandlerTest.java",
        "patchSetId": 2
      },
      "lineNbr": 71,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2024-02-12T11:52:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "75f1e67d_a7c490d6",
      "range": {
        "startLine": 71,
        "startChar": 40,
        "endLine": 71,
        "endChar": 60
      },
      "revId": "e0b2d064933fb2cae1ab2c72498b031fe4a4425b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}