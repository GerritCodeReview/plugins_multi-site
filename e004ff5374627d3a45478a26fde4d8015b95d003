{
  "comments": [
    {
      "key": {
        "uuid": "cea25b84_e2792dc9",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 333,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "Supporting multiple writes is a different problem.\nEven with R/W \u003c--\u003e R multi-site, you have the risk to go in split-brain.\n\nSee, for instance, what happened at GitHub in the last 24h outage: the connectivity was lost for a few seconds and the DR-site took control and went into split-brain straight away.",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4eaf84e6_bab016a3",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 333,
      "author": {
        "id": 1059414
      },
      "writtenOn": "2019-03-06T14:41:02Z",
      "side": 1,
      "message": "I think my explanation to the note below should answer.",
      "parentUuid": "cea25b84_e2792dc9",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70e5027c_0dd1f775",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 341,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "Why that? Stage #8 is sharding, that means that you are still sending writes to a single node on a per-repo basis.\nThe split brain may happen exactly with the same frequency and probability of stage #7.",
      "range": {
        "startLine": 340,
        "startChar": 20,
        "endLine": 341,
        "endChar": 45
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "452f7fd3_18252485",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 341,
      "author": {
        "id": 1059414
      },
      "writtenOn": "2019-03-06T14:41:02Z",
      "side": 1,
      "message": "The reason is the sharding reallocation when a node goes down. I should have clarified that.\n\nWhen a node owning a shard goes down you have two options:\n\n1. You make the full shard read only\n2. You reallocate the primary (RW instance) for that shard to one or other nodes hoping the data is fully in sync\n\nOption 2 will bring you to the risk of split brain",
      "parentUuid": "70e5027c_0dd1f775",
      "range": {
        "startLine": 340,
        "startChar": 20,
        "endLine": 341,
        "endChar": 45
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4de0f47c_6c7bf375",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 364,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-03-06T16:30:52Z",
      "side": 1,
      "message": "Copying a discussion from the PS1 here, to avoid ongoing discussion in several patch-sets.\n\n\u003e \u003e How would you actually define a misalignment?\n\u003e \n\u003e Misalignment with RefDirectory on the local git bare repo seen by Gerrit vs. a remote DfsRefDatabase, implemented on top of Zookeeper.\n\nThe possibility of using a DfsRefDatabase is not yet introduced at this point in the document\nand is only discussed later (line 402 in this PS). It is hard to read when such\nassumptions are implicit.",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "645dc792_b354f745",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 364,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T16:37:49Z",
      "side": 1,
      "message": "\u003e Copying a discussion from the PS1 here, to avoid ongoing discussion in several patch-sets.\n\u003e \n\u003e \u003e \u003e How would you actually define a misalignment?\n\u003e \u003e \n\u003e \u003e Misalignment with RefDirectory on the local git bare repo seen by Gerrit vs. a remote DfsRefDatabase, implemented on top of Zookeeper.\n\u003e \n\u003e The possibility of using a DfsRefDatabase is not yet introduced at this point in the document\n\u003e and is only discussed later (line 402 in this PS). It is hard to read when such\n\u003e assumptions are implicit.\n\n+1, it would be best to have a chapter dedicated to \"The introduction of a DfsRefDatabase\". Zookeeper could be the first implementation of it, just because it already exists :-)",
      "parentUuid": "4de0f47c_6c7bf375",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "698cfc99_baafa983",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 390,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "Performance, rather than scalability. Every push is paid more than twice in terms of elapsed time from a client perspective.",
      "range": {
        "startLine": 390,
        "startChar": 35,
        "endLine": 390,
        "endChar": 46
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0926213_d529f4d5",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 390,
      "author": {
        "id": 1059414
      },
      "writtenOn": "2019-03-06T14:41:02Z",
      "side": 1,
      "message": "True, performance is the first element to be affected. I mentioned scalability since increasing the number of nodes will actually make the system perform worse instead of better",
      "parentUuid": "698cfc99_baafa983",
      "range": {
        "startLine": 390,
        "startChar": 35,
        "endLine": 390,
        "endChar": 46
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5bcf6c20_5230528b",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 395,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "This is not true: they can still perform a lot of operations even if they are not 100% with the \"latest and greatest\" of a branch.\n\n- Serving the GUI\n- Reads\n- Accepting new changes\n- Accepting new patch-sets on existing changes",
      "range": {
        "startLine": 395,
        "startChar": 11,
        "endLine": 395,
        "endChar": 30
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92cdd213_d06d0800",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 395,
      "author": {
        "id": 1059414
      },
      "writtenOn": "2019-03-06T14:41:02Z",
      "side": 1,
      "message": "I should have wrote \"any write operation on that ref\"",
      "parentUuid": "5bcf6c20_5230528b",
      "range": {
        "startLine": 395,
        "startChar": 11,
        "endLine": 395,
        "endChar": 30
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4795256d_78911d53",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 398,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "At stages #7 and #8 we are talking about two sites only. Can you clarify the quorum here? I believe only from stage #9 you can start talking about \"majority\" and \"consensus\", but not before that.",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5f89361e_c8aad9b1",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 400,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "Quorum is out of context here, IMHO",
      "range": {
        "startLine": 400,
        "startChar": 13,
        "endLine": 400,
        "endChar": 19
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3d655e9_8656b7b9",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 409,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "I would mention one example only (e.g. Zookeeper, which is the one we use already in multi-site), otherwise it looks like a complete list, which is not.",
      "range": {
        "startLine": 408,
        "startChar": 40,
        "endLine": 409,
        "endChar": 23
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "91c50b83_7853d7ad",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 420,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "It is worth mentioning that an implementation of RefDb on top  of Zookeeper has been written already by Dave Borowitz.",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be24db47_b23837c3",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 420,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-03-06T14:20:11Z",
      "side": 1,
      "message": "Where is that implementation available?",
      "parentUuid": "91c50b83_7853d7ad",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9dac2dd_24c9c468",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 420,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T14:22:27Z",
      "side": 1,
      "message": "\u003e Where is that implementation available?\n\n@Dave can you share the link?",
      "parentUuid": "be24db47_b23837c3",
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6736b3b4_bc0e4846",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 429,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-03-06T13:45:47Z",
      "side": 1,
      "message": "Nope, that could never happen because only *certain operations* on *specific refs* would be blocked. Overall Gerrit masters will work as expected.",
      "range": {
        "startLine": 429,
        "startChar": 0,
        "endLine": 429,
        "endChar": 33
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "455c6c01_2bc8b41b",
        "filename": "DESIGN.md",
        "patchSetId": 5
      },
      "lineNbr": 429,
      "author": {
        "id": 1059414
      },
      "writtenOn": "2019-03-06T14:41:02Z",
      "side": 1,
      "message": "Ok, I need to find a better description.\n\nWhat about \"a set of refs in Read Only state across all the cluster\"?",
      "parentUuid": "6736b3b4_bc0e4846",
      "range": {
        "startLine": 429,
        "startChar": 0,
        "endLine": 429,
        "endChar": 33
      },
      "revId": "e004ff5374627d3a45478a26fde4d8015b95d003",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}