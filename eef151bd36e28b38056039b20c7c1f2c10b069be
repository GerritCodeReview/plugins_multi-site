{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "861ad70b_efb81c28",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 29,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-04-03T01:31:01Z",
      "side": 1,
      "message": "Invalid reference to a non-existent class E",
      "range": {
        "startLine": 29,
        "startChar": 29,
        "endLine": 29,
        "endChar": 38
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cbfd4148_4c481bdb",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 29,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-04-05T13:08:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "861ad70b_efb81c28",
      "range": {
        "startLine": 29,
        "startChar": 29,
        "endLine": 29,
        "endChar": 38
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5082aca0_29fa6504",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 33,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-04-01T01:01:30Z",
      "side": 1,
      "message": "Have you checked if you could reuse a Gerrit concept like the RetryableAction?\nThat was actually introduced for retrying some of the Gerrit operations, like the reindexing.\n\nSee the code at:\ncom.google.gerrit.server.update.RetryableAction\n\nExample:\npublic class RetryableIndexQueryAction\u003cQ extends InternalQuery\u003c?, Q\u003e, T\u003e\n    extends RetryableAction\u003cT\u003e {\n}",
      "range": {
        "startLine": 33,
        "startChar": 22,
        "endLine": 33,
        "endChar": 57
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1dc40641_68a47876",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 33,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-04-01T15:54:52Z",
      "side": 1,
      "message": "RetriableActions have been introduced in gerrit 3.2[1], this change is for 3.2.\nI took a look at its predecessor, RetryHelper, which is available in 3.1 [2], but I don\u0027t see a way to use it to achieve retries in multi-site, out of the box.\n\nIt reads any configuration from @GerritConfiguration rather than arbitrary plugin config and it seems to be based on timeouts, rather than number of retries, which is the strategy used by multi-site and high-availability.\n\nPerhaps you see a way to use it that I don\u0027t?\n\n[1]https://gerrit-review.googlesource.com/c/gerrit/+/247645\n[2]https://gerrit.googlesource.com/gerrit/+/refs/heads/stable-3.1/java/com/google/gerrit/server/update/RetryHelper.java",
      "parentUuid": "5082aca0_29fa6504",
      "range": {
        "startLine": 33,
        "startChar": 22,
        "endLine": 33,
        "endChar": 57
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "065fd92f_7fe7995f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 33,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-04-02T01:11:51Z",
      "side": 1,
      "message": "Gotcha, let\u0027s delay the refactoring then to master, to avoid conflicts when merging up.",
      "parentUuid": "1dc40641_68a47876",
      "range": {
        "startLine": 33,
        "startChar": 22,
        "endLine": 33,
        "endChar": 57
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0c36b5d2_c827e3aa",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 33,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-04-02T07:32:34Z",
      "side": 1,
      "message": "\u003e Gotcha, let\u0027s delay the refactoring then to master, to avoid conflicts when merging up.\n\nWhich refactoring do you mean? The refactoring proposed by this change (ForwardedIndexingHandlerWithRetries?) or a refactoring that uses RetriableActions?\n\nIf the latter, I didn\u0027t see a way to use RetriableActions with the logic needed by multi-site, not even in master, not sure it can be done by just using RetriableActions, for the reasons I mentioned.\n\nShall we continue with this refactoring in the meanwhile?",
      "parentUuid": "065fd92f_7fe7995f",
      "range": {
        "startLine": 33,
        "startChar": 22,
        "endLine": 33,
        "endChar": 57
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "25249116_06eeca9b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 33,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-04-03T01:11:51Z",
      "side": 1,
      "message": "\u003e \u003e Gotcha, let\u0027s delay the refactoring then to master, to avoid conflicts when merging up.\n\u003e \n\u003e Which refactoring do you mean? The refactoring proposed by this change (ForwardedIndexingHandlerWithRetries?) or a refactoring that uses RetriableActions?\n\u003e \n\u003e If the latter, I didn\u0027t see a way to use RetriableActions with the logic needed by multi-site, not even in master, not sure it can be done by just using RetriableActions, for the reasons I mentioned.\n\nAfter a second read, yes, what we need to do isn\u0027t included in the things that RetryableAction\u003c\u003e can do :-(\n\n\u003e Shall we continue with this refactoring in the meanwhile?\n\nYes.",
      "parentUuid": "0c36b5d2_c827e3aa",
      "range": {
        "startLine": 33,
        "startChar": 22,
        "endLine": 33,
        "endChar": 57
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd80521a_1ffe83bc",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 93,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-04-03T01:31:01Z",
      "side": 1,
      "message": "Actually, the method name tells that this method either checks or reschedule, but it is actually triggering also the reindexing.\n\nWhat about \u0027indexWhenUpToDateOrReschedule\u0027 ?",
      "range": {
        "startLine": 93,
        "startChar": 20,
        "endLine": 93,
        "endChar": 37
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e76de4a_2be08753",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 93,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-04-05T13:08:26Z",
      "side": 1,
      "message": "\u003e Actually, the method name tells that this method either checks or reschedule, but it is actually triggering also the reindexing.\n\nI agree the name is misleading.\n\n\u003e \n\u003e What about \u0027indexWhenUpToDateOrReschedule\u0027 ?\n\nThe method is actually *always* reindexing *and then* checking the change is up-to-date, possibly rescheduling.\n\nThis is a requirement imposed by the change indexer (see current implementation: [1] and related test[2]).\n\nI renamed this method \u0027reindexAndCheckIsUpToDate\u0027.\n\nWDYT?\n\n\n[1]https://gerrit.googlesource.com/plugins/multi-site/+/refs/heads/stable-3.1/src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexChangeHandler.java#80\n\n[2]https://gerrit.googlesource.com/plugins/multi-site/+/refs/heads/stable-3.1/src/test/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexChangeHandlerTest.java#104",
      "parentUuid": "fd80521a_1ffe83bc",
      "range": {
        "startLine": 93,
        "startChar": 20,
        "endLine": 93,
        "endChar": 37
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "94554dff_a2534024",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/forwarder/ForwardedIndexingHandlerWithRetries.java",
        "patchSetId": 5
      },
      "lineNbr": 93,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-04-10T02:36:27Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1e76de4a_2be08753",
      "range": {
        "startLine": 93,
        "startChar": 20,
        "endLine": 93,
        "endChar": 37
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44084f56_02f54a94",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/index/Checker.java",
        "patchSetId": 5
      },
      "lineNbr": 6,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2021-04-03T01:31:01Z",
      "side": 1,
      "message": "UpToDateChecker would be more specific",
      "range": {
        "startLine": 6,
        "startChar": 17,
        "endLine": 6,
        "endChar": 24
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "39381bc0_2df89468",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/multisite/index/Checker.java",
        "patchSetId": 5
      },
      "lineNbr": 6,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2021-04-05T13:08:26Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "44084f56_02f54a94",
      "range": {
        "startLine": 6,
        "startChar": 17,
        "endLine": 6,
        "endChar": 24
      },
      "revId": "eef151bd36e28b38056039b20c7c1f2c10b069be",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}