{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "81c50910_a96d6afe",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 13,
      "author": {
        "id": 1063024
      },
      "writtenOn": "2023-10-11T08:30:02Z",
      "side": 1,
      "message": "`lightweight`",
      "range": {
        "startLine": 13,
        "startChar": 10,
        "endLine": 13,
        "endChar": 18
      },
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "148be831_ea72bfe7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 11
      },
      "lineNbr": 13,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-10-12T13:51:48Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "81c50910_a96d6afe",
      "range": {
        "startLine": 13,
        "startChar": 10,
        "endLine": 13,
        "endChar": 18
      },
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bef26c9e_ba12648e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2023-10-11T19:26:06Z",
      "side": 1,
      "message": "@marcin are we still consuming the wrong version of events-broker?\n\nJenkins throws\n\n```\nplugins/multi-site/src/main/java/com/googlesource/gerrit/plugins/multisite/validation/ProjectVersionRefUpdateImpl.java:177: error: cannot find symbol\n    if (sharedRefDb.isSetOperationSupported()) {\n                   ^\n  symbol:   method isSetOperationSupported()\n  location: variable sharedRefDb of type SharedRefDatabaseWrapper\nplugins/multi-site/src/main/java/com/googlesource/gerrit/plugins/multisite/validation/ProjectVersionRefUpdateImpl.java:178: error: cannot find symbol\n      sharedRefDb.put(projectNameKey, MULTI_SITE_VERSIONING_VALUE_REF, newVersion.toString());\n```",
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "359e2b8b_b0e7cfc9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-10-12T10:47:08Z",
      "side": 1,
      "message": "yes, we still need global-refdb change to be merged:\nhttps://gerrit-review.googlesource.com/c/modules/global-refdb/+/387101",
      "parentUuid": "bef26c9e_ba12648e",
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "397f1376_e99a1b59",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-10-13T16:33:54Z",
      "side": 1,
      "message": "I am wondering if this would then break existing setups: I believe we should take a more conservative approach and discover the method using an additional interface, pretty much like we did with the events-broker.",
      "parentUuid": "359e2b8b_b0e7cfc9",
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "27510c1e_776d291c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2023-10-16T12:05:31Z",
      "side": 1,
      "message": "I thought about the same but `sharedRefDb.isSetOperationSupported()` is checking the additional interface and it\u0027s coming from `SharedRefDatabaseWrapper`:\n```\npublic boolean isSetOperationSupported() {\n    return sharedRefDb() instanceof ExtendedGlobalRefDatabase;\n  }\n```\nThis is the same approach as we have in events-broker. If we remove that method and  have the check directly in the code if someone deploy multi-site with old global-refdb lib he will get class not found `ExtendedGlobalRefDatabase` which is quite similar to missing method `isSetOperationSupported`. If we want to allow old events-broker or global-refdb to work with newest build of the multi-site we would have to check interface name converted to String, something like this:\n```\nArrays.stream(sharedRefDb().getClass().getInterfaces()).map(Class::getName).anyMatch(clName -\u003e clName.contains(\"ExtendedGlobalRefDatabase\"));\n```",
      "parentUuid": "397f1376_e99a1b59",
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96c23326_976b121c",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/validation/ProjectVersionRefUpdateTest.java",
        "patchSetId": 11
      },
      "lineNbr": 126,
      "author": {
        "id": 1063024
      },
      "writtenOn": "2023-10-11T08:30:02Z",
      "side": 1,
      "message": "Is there a way we could test the difference in behaviour between `CompareAndPut` and `Put` instead of testing that we\u0027re calling `put` instead of `compareAndPut`?",
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a388593e_913e7761",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/validation/ProjectVersionRefUpdateTest.java",
        "patchSetId": 11
      },
      "lineNbr": 126,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2023-10-13T16:33:54Z",
      "side": 1,
      "message": "Well, the focus of this test is that we call `put` and not `compareAndPut`. The difference of behaviour should not be in this test IMHO.",
      "parentUuid": "96c23326_976b121c",
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "25cd583b_287dc0f9",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/multisite/validation/ProjectVersionRefUpdateTest.java",
        "patchSetId": 11
      },
      "lineNbr": 126,
      "author": {
        "id": 1063024
      },
      "writtenOn": "2023-10-16T08:16:28Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "a388593e_913e7761",
      "revId": "ff81bd890b8158f84ba5c3d079a17587c563e33a",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}